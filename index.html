<!DOCTYPE HTML>
<html>
<head>
<title>Cordova</title>
<script type="text/javascript" charset="utf-8" src="cordova-1.7.0.js"></script>
<link rel="stylesheet" href="jquery.mobile-1.1.0.min.css" />
<script src="jquery-1.7.2.min.js"></script>
<script src="jquery.mobile-1.1.0.min.js"></script>
<script type="text/javascript">
	var count = 0;
	var msecsFirst = 0;
	var msecsPrevious = 0;
	var actualBPM=0;
	$("#tapDiv").live("tap", function(event) {
		TapForBPM();
	});
	
	var timerID = setTimeout("getNewSong()", 5000);

	function ResetCount() {
		count = 0;
		$("#Tavg").val("");
		//document.TAP_DISPLAY.T_TAP.value = "";
		$("#T_RESET").blur();
	}

	function TapForBPM() {

		$("#t_wait").blur();
		timeSeconds = new Date;
		msecs = timeSeconds.getTime();
		if ((msecs - msecsPrevious) > 1000 * $("#t_wait").value) {
			count = 0;
		}

		if (count == 0) {
			$("#Tavg").val("First Beat");
			//document.TAP_DISPLAY.T_TAP.value = "First Beat";
			msecsFirst = msecs;
			count = 1;
		} else {
			bpmAvg = 60000 * count / (msecs - msecsFirst);
			$("#Tavg").val(Math.round(bpmAvg));
			actualBPM=Math.round(bpmAvg);
			count++;
			//document.TAP_DISPLAY.T_TAP.value = count;
		}
		msecsPrevious = msecs;
		return true;
	}
	
	
	
	function getNewSong() {
		minVal=actualBPM-5;
		maxVal=actualBPM+5;
		var url = 'http://musictechfest:mtflondon2012_@ella.bmat.ws/collections/tags/tags/electronic/similar/collections/bmat/tracks?filter=rhythm.bpm:['+minVal+'%20TO%20'+maxVal+']&format=json&similarity_type=playlist';
		$.ajax({
			url: url,
			dataType: 'jsonp',
			jsonp: 'callback',
			jsonpCallback: 'playMusic'
		});
		}
		
		 var playMusic = function(data) {
	   	  alert(JSON.stringify(data));
		 }
</script>
</head>
<body>

	<!-- Start of first page: #one -->
	<div data-role="page" id="one">

		<div data-role="header">
			<h1>APP</h1>
		</div>
		<!-- /header -->

		<div data-role="content">
			<h2>One</h2>

			<p>
				<a href="#two" data-role="button">Start</a>
			</p>
		</div>
		<!-- /content -->

		<div data-role="footer" data-theme="d">
			<h4>Page Footer</h4>
		</div>
		<!-- /footer -->
	</div>
	<!-- /page one -->


	<!-- Start of second page: #two -->
	<div data-role="page" id="two" data-theme="a">

		<div data-role="header">
			<h1>Two</h1>
		</div>
		<!-- /header -->

		<div data-role="content" data-theme="a">
			<div data-role="fieldcontain">
				<label for="name">BPMs:</label> <input type="text" name="name"
					id="Tavg" value="" />
			</div>
			<div class="tapDiv" style="height: 150px; border-style: solid"
				id="tapDiv">Touch here</div>

			<div id="nameSong"></div>




			<div data-role="fieldcontain">
				Pause <select name="t_wait">
					<option value="1">1</option>
					<option value="2" SELECTED>2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select> second(s) or <input type="button" name="T_RESET" value="RESET"
					onclick="ResetCount()"> to start again
			</div>



		</div>
		<!-- /content -->

		<div data-role="footer">
			<h4>Page Footer</h4>
		</div>
		<!-- /footer -->
	</div>
	<!-- /page two -->




</body>
</html>